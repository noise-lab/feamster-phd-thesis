\subsection{Indirect iBGP Feeds from Border Routers} \label{subsec:ibgpResult}

%We now present our analysis results of the iBGP feeds from border
%routers of AT\&T's network. 

%We validated the inference algorithm from Section~\ref{sec:algo} and to
%study the extent to which AT\&T's other peers send inconsistent
%advertisements.  
We apply our algorithm to iBGP updates received at a monitor that is
configured as a route-reflector client to the AT\&T border routers
that connect to peers.  Our analysis excluded a small number of peers
where the import policies did not satisfy Condition~2 in
Section~\ref{sec:limit}.  About half of the inconsistencies discovered
for the peer in Section~\ref{subsec:ebgpResult} were also discovered
by the iBGP analysis; the other half of the inconsistencies were
obscured by arbitrary tiebreaking at the router or because AT\&T
chose a route through a customer rather than a peer.  Overall,
two-thirds of AT\&T's peers {\em never\/} had more than five
inconsistent prefixes at time.

Our analysis in Figure~\ref{fig:ibgp_result} focuses on five of the
remaining peers; Peer 3 corresponds to the same peer analyzed in
Section~\ref{subsec:ebgpResult}.  At any given time, at most a few
hundred prefixes have inconsistent advertisements.
Figure~\ref{fig:ibgp_result}(a) shows the distribution of
inconsistency duration for five peers, excluding the large number of
events that persist for less than one second due to transient routing
changes.  The peers exhibit varying degrees of inconsistency.  Peer 4,
for instance, has significantly longer inconsistency events; in fact,
this peer advertises more than $100$ prefixes inconsistently for the
entire duration of our study.
%Peer 1 appears to have a higher fraction of short-lived
%inconsistent events. All curves drop off at the end due to the 8-day
%period of the study. 
Figure~\ref{fig:ibgp_result}(b) shows the distribution of time for
which the prefixes each peer advertised are inconsistent.  About 20\% of
the prefixes advertised by Peer~4 are inconsistent more than 30\% of the
time.
%Most of these prefixes are seen as inconsistent close to 100\%
%of the time.  
For the other peers, only 10\% of prefixes advertised from any other
were {\em ever\/} advertised inconsistently, and more than 90\% of the
prefixes were consistent at least 99\% of the time.

To quantify the impact of routing inconsistencies, we analyzed the
traffic destined to inconsistent prefixes using Netflow data collected
from the border routers.  We focused on the ten most inconsistent
prefixes per peer and all prefixes that were inconsistent for the entire
one-day period.  The inconsistencies corresponded to less than 1\% of
the prefixes and less than 0.5\% of the traffic leaving AT\&T via the
peering links.  
Although the inconsistencies involve small amounts of
traffic, some can cause significant traffic diversions: one neighbor ISP
failed to advertise 30 prefixes at five separate locations for the
entire duration of the trace.  
In our future work, we plan to analyze the traffic
directed to specific peers (such as Peer~4) in more detail and
analyze longer traces.  
%Thus, ISPs should be vigilant to prevent
%intentional violations and ensure quick resolution of unintentional
%inconsistencies.
%comparison with the ebgp results
%
%todo: (b) 20040503
